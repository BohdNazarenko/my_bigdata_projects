–î–æ–±—Ä—ã–π –¥–µ–Ω—å!

–Ø –Ω–µ–º–Ω–æ–≥–æ —Ä–µ—à–∏–ª –∑–∞–º–æ—Ä–æ—á–∏—Ç—å—Å—è –Ω–∞–¥ –∑–∞–¥–∞–Ω–∏–µ–º, –∏ –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ, —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ 
–ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ –µ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–µ —è –Ω–µ –∑–Ω–∞—é, –≤—Ç–æ—Ä—É—é —á–∞—Å—Ç—å –≤–µ–±–∏–Ω–∞—Ä–∞ —è –µ—â–µ –Ω–µ —Å–º–æ—Ç—Ä–µ–ª :)

–í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –µ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è [`kafka`](kafka), –≤ –∫–æ—Ç–æ—Ä–æ–π –ª–µ–∂–∞—Ç:

1) [`docker-compose.yml`](kafka/first_study_pipeline/docker-compose.yml) - 
–∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è c –ø–æ–º–æ—â—å—é —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up -d`, –Ω–∞—Ö–æ–¥—è—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–∞–ø–∫–∏ [`kafka`](kafka) 
—Å –æ—Ç–∫—Ä—ã—Ç—ã–º Docker Desktop –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (–∑–Ω–∞—é —á—Ç–æ –≤—ã –ª—É—á—à–µ –º–µ–Ω—è —ç—Ç–æ –∑–Ω–∞–µ—Ç–µ, –Ω–æ —Ö–æ—á–µ—Ç—Å—è –Ω–∞—É—á–∏—Ç—å—Å—è –ø–∏—Å–∞—Ç—å —Ä–∏–¥–º–∏ 
–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ –¥–∞–∂–µ —Ç–æ–º—É, –∫—Ç–æ –Ω–∏ —Ä–∞–∑—É –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–ªüòä);


2) [`producer.py`](kafka/first_study_pipeline/producer.py) - –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∫–æ–º–∞–Ω–¥–æ–π `python 
producer.py` –Ω–∞—Ö–æ–¥—è—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ kafka –ø—Ä–æ–µ–∫—Ç–∞.

–í –¥–∞–Ω–Ω–æ–º –º–æ–¥—É–ª–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç-–∫–ª–∏–µ–Ω—Ç KafkaProducer, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫, bootstrap_servers —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
–∫ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º—É –ø–æ—Ä—Ç—É 9092 –∏ value_serializer, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –ø–∞–π—Ç–æ–Ω–∞ –≤ JSON-—Å—Ç—Ä–æ–∫—É —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8, —á—Ç–æ–±—ã 
producer –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª –µ–≥–æ –≤ –±–∞–π—Ç–æ–≤—ã–π –º–∞—Å—Å–∏–≤.

–Ø —Ä–µ—à–∏–ª –Ω–µ –º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã, –∞ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é user_logins_kafka_status —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ 
id(—Å–≤—è–∑—å –æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É —Å id —Ç–∞–±–ª–∏—Ü—ã user_logins) –∏ sent_to_kafka boolean (—Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø–∏—Å–∏ –≤ producer). 
–Ø —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–ª —Å –ø–æ–º–æ—â—å—é Trigger, –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ, —á—Ç–æ –æ–Ω —Å–∞–º –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ id –≤ 
—Ç–∞–±–ª–∏—Ü—É user_logins_kafka_status.

–î–∞–ª–µ–µ —è —Å–æ–∑–¥–∞–ª —Ç–µ—Å—Ç–æ–≤—ã—Ö —é–∑–µ—Ä–æ–≤, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∏—Ö –∑–∞–ø–∏—Å–∏ –∏ –¥–æ–±–∞–≤–∏–ª –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É user_logins. –î–∞–ª–µ–µ —Å –ø–æ–º–æ—â—å—é –∫—É—Ä—Å–æ—Ä–∞ –∏
Left join —è –≤—ã–±—Ä–∞–ª —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º False –∏ –¥–æ–±–∞–≤–∏–ª –∏—Ö –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–∏—Å—Ç–∞ —Å–ª–æ–≤–∞—Ä–µ–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é rows. –î–∞–ª–µ–µ 
–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π rows –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –µ–¥–∏–Ω–∏—á–Ω–æ —Å –ø–æ–º–æ—â—å—é —Ü–∏–∫–ª–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ producer. –ò –ª–∏—à—å –ø–æ—Ç–æ–º –≤ —Ç–∞–±–ª–∏—Ü–µ user_logins_kafka_status
–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏ –∏–∑ FALSE –Ω–∞ TRUE. 

3) [`consumer.py`](kafka/first_study_pipeline/consumer.py) –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `python consumer.py` –Ω–∞—Ö–æ–¥—è—Å—å –≤ 
–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ kafka –ø—Ä–æ–µ–∫—Ç–∞. –ó–¥–µ—Å—å —è –∏–∑–º–µ–Ω–∏–ª —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏, –∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤–∑—è—Ç –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ "5.1 –í–≤–µ–¥–µ–Ω–∏–µ –≤ streaming 3 —Å—Ç—Ä–∞–Ω–∏—Ü–∞". 

–ü—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ —ç—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —É–∂–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ producer –∏ consumer sql –∫–æ–º–∞–Ω–¥–∞–º–∏:

Postgres:

1) SELECT * FROM user_logins; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins,


2) SELECT COUNT(*) FROM user_logins; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–ª-–≤–∞ –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins,


3) SELECT * FROM user_logins_kafka_status; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins_kafka_status,


4) SELECT COUNT(*) FROM user_logins_kafka_status; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–ª-–≤–∞ –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins_kafka_status,

5) BEGIN;
TRUNCATE user_logins_kafka_status,
         user_logins;
COMMIT;   - —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü user_logins_kafka_status –∏ user_logins_kafka_status —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É
—Å–æ–±–æ–π –∫–∞—Å–∫–∞–¥–Ω–æ.

Clickhouse:

1) SELECT COUNT(*) FROM user_logins; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins (–ø–æ—Å–ª–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö producer –∏ consumer)
–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å;


2) SELECT COUNT(distinct *) FROM user_logins; - –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–ª-–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins (—á–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ 
—Å–æ–≤–ø–∞–¥–∞—Ç—å —Å COUNT(*));


3) TRUNCATE TABLE user_logins; - –æ—á–∏—Å—Ç–∫–∞ –∑–∞–ø–∏—Å–µ–π —Ç–∞–±–ª–∏—Ü—ã user_logins.


–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ ü§ó

